# EzySpeechTranslate - 项目总览

## 📋 项目简介

EzySpeechTranslate 是一个完整的实时语音翻译系统，集成了语音识别（ASR）、机器翻译（MT）、人工校对和多端展示功能。适用于会议、讲座、直播等场景的实时翻译需求。

## 🎯 核心功能

### 1. 语音识别（ASR）
- 使用 OpenAI Whisper 模型
- 支持实时音频流处理
- 自动静音检测和分段
- 多音频源支持（麦克风/虚拟声卡）

### 2. 机器翻译（MT）
- 默认集成 Google Translate
- 支持切换到 DeepL API
- 实时翻译推送
- 自动重试机制

### 3. 人工校对
- Qt6 桌面管理界面
- 实时编辑翻译结果
- 校对状态标记
- 双语对照显示

### 4. 多端展示
- 网页听众端
- WebSocket 实时同步
- TTS 语音播报
- 字幕下载导出

## 📁 文件结构

```
EzySpeechTranslate/
│
├── 核心文件
│   ├── app.py                 # Flask 后端服务（主程序）
│   ├── admin_gui.py           # Qt6 管理员界面
│   ├── config.py              # 配置文件
│   └── requirements.txt       # Python 依赖
│
├── 网页界面
│   └── templates/
│       └── index.html         # 听众端网页
│
├── 启动脚本
│   ├── start.sh               # Linux/macOS 启动脚本
│   ├── start.bat              # Windows 启动脚本
│   └── test_system.py         # 系统测试脚本
│
└── 文档
    ├── README.md              # 使用说明
    └── PROJECT_OVERVIEW.md    # 项目总览（本文件）
```

## 🔧 技术架构

### 后端架构
```
┌─────────────────────────────────────────┐
│           Flask 服务器                   │
│  ┌────────────────────────────────────┐ │
│  │  WebSocket (Socket.IO)             │ │
│  │  - 实时通信                         │ │
│  │  - 广播翻译结果                     │ │
│  │  - 同步校对更新                     │ │
│  └────────────────────────────────────┘ │
│                                          │
│  ┌────────────────────────────────────┐ │
│  │  ASR 处理线程                       │ │
│  │  - 音频队列管理                     │ │
│  │  - Whisper 转录                     │ │
│  │  - 静音检测                         │ │
│  └────────────────────────────────────┘ │
│                                          │
│  ┌────────────────────────────────────┐ │
│  │  翻译引擎                           │ │
│  │  - Google Translate / DeepL        │ │
│  │  - 自动重试                         │ │
│  └────────────────────────────────────┘ │
│                                          │
│  ┌────────────────────────────────────┐ │
│  │  数据管理                           │ │
│  │  - 翻译历史存储                     │ │
│  │  - 校对状态管理                     │ │
│  └────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 前端架构

#### 管理员端（Qt6）
```
┌──────────────────────────────────┐
│  AdminWindow (QMainWindow)       │
│  ┌────────────────────────────┐  │
│  │  控制面板                   │  │
│  │  - 设备选择                 │  │
│  │  - 录制控制                 │  │
│  │  - 状态监控                 │  │
│  └────────────────────────────┘  │
│                                   │
│  ┌────────────────────────────┐  │
│  │  实时预览区                 │  │
│  │  - 滚动文本显示             │  │
│  │  - 双语内容                 │  │
│  └────────────────────────────┘  │
│                                   │
│  ┌────────────────────────────┐  │
│  │  校对编辑区                 │  │
│  │  - 表格显示                 │  │
│  │  - 内容编辑                 │  │
│  │  - 批量保存                 │  │
│  └────────────────────────────┘  │
│                                   │
│  ┌────────────────────────────┐  │
│  │  SocketIO 线程              │  │
│  │  - 异步通信                 │  │
│  │  - 信号处理                 │  │
│  └────────────────────────────┘  │
└──────────────────────────────────┘
```

#### 听众端（Web）
```
┌──────────────────────────────────┐
│  网页客户端 (HTML5)              │
│  ┌────────────────────────────┐  │
│  │  控制栏                     │  │
│  │  - TTS 开关                 │  │
│  │  - 语速/音量调节            │  │
│  │  - 字幕导出                 │  │
│  └────────────────────────────┘  │
│                                   │
│  ┌────────────────────────────┐  │
│  │  字幕显示区                 │  │
│  │  - 实时更新                 │  │
│  │  - 动画效果                 │  │
│  │  - 校对标记                 │  │
│  └────────────────────────────┘  │
│                                   │
│  ┌────────────────────────────┐  │
│  │  Socket.IO 客户端           │  │
│  │  - WebSocket 连接           │  │
│  │  - 事件监听                 │  │
│  └────────────────────────────┘  │
│                                   │
│  ┌────────────────────────────┐  │
│  │  Web Speech API             │  │
│  │  - TTS 语音合成             │  │
│  │  - 语音控制                 │  │
│  └────────────────────────────┘  │
└──────────────────────────────────┘
```

## 🔄 数据流程

### 完整流程图
```
┌──────────────┐
│   麦克风      │
│  或虚拟声卡   │
└──────┬───────┘
       │ 音频流
       ▼
┌──────────────┐
│  PyAudio     │
│  音频采集     │
└──────┬───────┘
       │ PCM 数据
       ▼
┌──────────────┐
│  音频队列     │
│  静音检测     │
└──────┬───────┘
       │ 音频段
       ▼
┌──────────────┐
│  Whisper     │
│  语音识别     │
└──────┬───────┘
       │ 英文文本
       ▼
┌──────────────┐
│  Translator  │
│  机器翻译     │
└──────┬───────┘
       │ 中文文本
       ▼
┌──────────────┐
│  历史记录     │
│  数据存储     │
└──────┬───────┘
       │
       ├───────────────┬──────────────┐
       │               │              │
       ▼               ▼              ▼
┌──────────┐   ┌──────────┐   ┌─────────┐
│ 管理员端  │   │ 听众端    │   │ 其他端   │
│ (校对)    │   │ (展示)    │   │ (扩展)   │
└──────────┘   └──────────┘   └─────────┘
```

### 校对流程
```
管理员编辑
    │
    ▼
保存校对 (API)
    │
    ▼
更新历史记录
    │
    ▼
WebSocket 广播
    │
    ├───────────┬───────────┐
    ▼           ▼           ▼
管理员界面   听众端       其他客户端
(更新标记)  (更新显示)   (同步更新)
```

## 📊 API 接口文档

### REST API

#### GET /api/devices
获取可用音频设备列表
```json
Response: [
  {
    "index": 0,
    "name": "麦克风",
    "channels": 1
  }
]
```

#### POST /api/start
开始录制
```json
Request: {
  "device_index": 0
}
Response: {
  "status": "started"
}
```

#### POST /api/stop
停止录制
```json
Response: {
  "status": "stopped"
}
```

#### GET /api/history
获取翻译历史
```json
Response: [
  {
    "id": 0,
    "timestamp": "2025-10-18 10:30:00",
    "english": "Hello world",
    "chinese": "你好世界",
    "corrected": "你好世界",
    "is_corrected": false
  }
]
```

#### POST /api/correct
提交校对
```json
Request: {
  "id": 0,
  "corrected": "修正后的翻译"
}
Response: {
  "status": "success"
}
```

#### POST /api/clear
清空历史
```json
Response: {
  "status": "cleared"
}
```

### WebSocket 事件

#### 服务器 → 客户端

- `connect`: 连接成功
- `disconnect`: 连接断开
- `history`: 历史记录（连接时发送）
- `new_translation`: 新翻译结果
- `translation_corrected`: 翻译已校对
- `history_cleared`: 历史已清空

#### 客户端 → 服务器

- `connect`: 发起连接
- `disconnect`: 断开连接

## 🚀 部署建议

### 开发环境
```bash
# 本地运行
python app.py  
```

### 生产环境
```bash
# 使用 Gunicorn + Nginx
gunicorn -k eventlet -w 1 -b 0.0.0.0:PORT app:app
```

### Docker 部署
```dockerfile
FROM python:3.9
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
CMD ["python", "app.py"]
```

## 🔒 安全注意事项

1. **密钥管理**: 修改 `config.py` 中的 `SECRET_KEY`
2. **CORS 配置**: 生产环境限制 `CORS_ORIGINS`
3. **API 认证**: 添加身份验证中间件
4. **HTTPS**: 使用 SSL/TLS 加密通信
5. **速率限制**: 防止 API 滥用

## 📈 性能优化

### Whisper 模型选择
- **tiny**: 最快，适合低配置
- **base**: 推荐，平衡性能
- **large**: 最准确，需要 GPU

### 音频优化
- 调整 `AUDIO_CHUNK` 大小
- 优化静音检测阈值
- 使用音频预处理（降噪）

### 网络优化
- 启用 WebSocket 压缩
- 调整心跳间隔
- 使用 CDN 加速静态资源

## 🐛 常见问题

### 1. 音频设备找不到
- 检查系统权限
- 安装 PortAudio
- 重启应用程序

### 2. Whisper 加载慢
- 首次运行需下载模型
- 使用 SSD 存储
- 考虑使用小型模型